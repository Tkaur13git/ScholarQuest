<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScholarQuest - Scholarship Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'aqua': {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a',
                        }
                    }
                }
            }
        }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // "ScholarQuest" - A Gamified Scholarship Finder

        const { useState } = React;

        // Sample scholarships data
        const SCHOLARSHIPS = [
          {
            id: 1,
            name: "STEM Stars Scholarship",
            description: "For students majoring in STEM fields.",
            criteria: { major: ["Engineering", "Computer Science", "Mathematics", "Physics"] },
            reward: 100,
          },
          {
            id: 2,
            name: "Future Leaders Award",
            description: "For students with leadership experience.",
            criteria: { age: [18, 19, 20, 21, 22], major: ["Business", "Political Science"] },
            reward: 80,
          },
          {
            id: 3,
            name: "Creative Minds Grant",
            description: "For students in creative majors.",
            criteria: { major: ["Art", "Design", "Music", "Literature"] },
            reward: 90,
          },
          {
            id: 4,
            name: "Community Hero Scholarship",
            description: "For students with community service experience.",
            criteria: { },
            reward: 70,
          },
          {
            id: 5,
            name: "Women in Tech Scholarship",
            description: "For women in technology-related majors.",
            criteria: { major: ["Computer Science", "Engineering"], gender: ["Female"] },
            reward: 120,
          },
        ];

        const MAJORS = [
          "Engineering",
          "Computer Science",
          "Mathematics",
          "Physics",
          "Business",
          "Political Science",
          "Art",
          "Design",
          "Music",
          "Literature",
        ];

        function matchesCriteria(scholarship, user) {
          // Check each criteria; if present, must match
          if (scholarship.criteria.major && !scholarship.criteria.major.includes(user.major)) {
            return false;
          }
          if (scholarship.criteria.age && !scholarship.criteria.age.includes(Number(user.age))) {
            return false;
          }
          if (scholarship.criteria.gender && !scholarship.criteria.gender.includes(user.gender)) {
            return false;
          }
          return true;
        }

        function ScholarQuest() {
          const [user, setUser] = useState({
            name: "",
            age: "",
            major: "",
            gender: "",
            leadership: false,
            community: false,
          });
          const [submitted, setSubmitted] = useState(false);
          const [applied, setApplied] = useState([]);
          const [xp, setXp] = useState(0);
          const [userId, setUserId] = useState(null);
          const [loading, setLoading] = useState(false);
          const [error, setError] = useState(null);
          const [scholarships, setScholarships] = useState([]);

          // API functions
          const API_BASE = 'http://localhost:3001/api';

          const fetchScholarships = async () => {
            try {
              const response = await fetch(`${API_BASE}/scholarships`);
              if (!response.ok) throw new Error('Failed to fetch scholarships');
              const data = await response.json();
              setScholarships(data);
            } catch (err) {
              console.error('Error fetching scholarships:', err);
              setError('Failed to load scholarships');
            }
          };

          const saveUserProfile = async (userData) => {
            try {
              setLoading(true);
              const response = await fetch(`${API_BASE}/users`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(userData),
              });
              
              if (!response.ok) throw new Error('Failed to save profile');
              const data = await response.json();
              setUserId(data.id);
              setXp(data.total_xp);
              return data;
            } catch (err) {
              console.error('Error saving profile:', err);
              setError('Failed to save profile');
              throw err;
            } finally {
              setLoading(false);
            }
          };

          const getUserProfile = async (name) => {
            try {
              const response = await fetch(`${API_BASE}/users/${encodeURIComponent(name)}`);
              if (!response.ok) throw new Error('User not found');
              const data = await response.json();
              setUserId(data.id);
              setXp(data.total_xp);
              return data;
            } catch (err) {
              console.error('Error fetching user:', err);
              return null;
            }
          };

          const applyToScholarship = async (scholarship) => {
            try {
              const response = await fetch(`${API_BASE}/applications`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  userId: userId,
                  scholarshipId: scholarship.id,
                  scholarshipName: scholarship.name,
                  xpEarned: scholarship.reward,
                }),
              });
              
              if (!response.ok) throw new Error('Failed to apply');
              const data = await response.json();
              setXp(prev => prev + scholarship.reward);
              setApplied(prev => [...prev, scholarship.id]);
              return data;
            } catch (err) {
              console.error('Error applying:', err);
              setError('Failed to apply to scholarship');
              throw err;
            }
          };

          // Load scholarships on component mount
          React.useEffect(() => {
            fetchScholarships();
          }, []);

          const handleChange = (e) => {
            const { name, value, type, checked } = e.target;
            setUser((prev) => ({
              ...prev,
              [name]: type === "checkbox" ? checked : value,
            }));
          };

          const handleSubmit = async (e) => {
            e.preventDefault();
            setError(null);
            
            try {
              // First try to get existing user profile
              const existingUser = await getUserProfile(user.name);
              
              if (existingUser) {
                // Update existing profile
                await saveUserProfile(user);
              } else {
                // Create new profile
                await saveUserProfile(user);
              }
              
              setSubmitted(true);
            } catch (err) {
              console.error('Error submitting form:', err);
              setError('Failed to save profile. Please try again.');
            }
          };

          const handleApply = async (scholarship) => {
            if (!applied.includes(scholarship.id) && userId) {
              try {
                await applyToScholarship(scholarship);
              } catch (err) {
                console.error('Error applying to scholarship:', err);
                // Error is already set in the applyToScholarship function
              }
            }
          };

          // Filter scholarships based on user input
          let relevantScholarships = [];
          if (submitted) {
            relevantScholarships = scholarships.filter((sch) => {
              // Add extra logic for leadership/community checkboxes
              if (sch.name === "Future Leaders Award" && !user.leadership) return false;
              if (sch.name === "Community Hero Scholarship" && !user.community) return false;
              return matchesCriteria(sch, user);
            });
          }

          // Gamified: XP levels
          const getLevel = (xp) => {
            if (xp >= 300) return "Scholarship Master";
            if (xp >= 200) return "Scholarship Pro";
            if (xp >= 100) return "Scholarship Explorer";
            if (xp >= 50) return "Scholarship Novice";
            return "Scholarship Newbie";
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-aqua-50 to-aqua-100 py-8 px-4">
              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
                  <div className="text-center mb-8">
                    <h1 className="text-5xl font-bold text-aqua-600 mb-4">🎓 ScholarQuest</h1>
                    <p className="text-lg text-gray-600 max-w-2xl mx-auto">
                      Level up your future! Find and apply to scholarships tailored for you. Earn XP for every application!
                    </p>
                  </div>
                  
                  <div className="bg-gradient-to-r from-aqua-100 to-aqua-200 rounded-xl p-6 mb-8">
                    <div className="flex flex-col sm:flex-row justify-between items-center gap-4">
                      <div className="flex items-center gap-3">
                        <div className="bg-aqua-500 text-white px-4 py-2 rounded-lg font-semibold">
                          XP: {xp}
                        </div>
                        <span className="text-aqua-700 font-medium">({getLevel(xp)})</span>
                      </div>
                      <div className="flex items-center gap-2 text-aqua-700">
                        <span className="text-2xl">🏆</span>
                        <span className="font-semibold">Applications: {applied.length}</span>
                      </div>
                    </div>
                  </div>
                  
                  {error && (
                    <div className="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
                      <div className="flex items-center gap-2">
                        <span className="text-red-600">⚠️</span>
                        <span className="text-red-700 font-medium">{error}</span>
                      </div>
                    </div>
                  )}
              {!submitted ? (
                <div className="bg-gray-50 rounded-xl p-6">
                  <h2 className="text-2xl font-bold text-aqua-700 mb-6 text-center">Create Your Profile</h2>
                  <form onSubmit={handleSubmit} className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          Name
                        </label>
                        <input
                          type="text"
                          name="name"
                          value={user.name}
                          onChange={handleChange}
                          required
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-aqua-500 focus:border-aqua-500 transition-colors"
                          placeholder="Enter your full name"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          Age
                        </label>
                        <input
                          type="number"
                          name="age"
                          value={user.age}
                          onChange={handleChange}
                          required
                          min={16}
                          max={99}
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-aqua-500 focus:border-aqua-500 transition-colors"
                          placeholder="Enter your age"
                        />
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          Major
                        </label>
                        <select
                          name="major"
                          value={user.major}
                          onChange={handleChange}
                          required
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-aqua-500 focus:border-aqua-500 transition-colors"
                        >
                          <option value="">Select your major</option>
                          {MAJORS.map((m) => (
                            <option key={m} value={m}>{m}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                          Gender
                        </label>
                        <select
                          name="gender"
                          value={user.gender}
                          onChange={handleChange}
                          required
                          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-aqua-500 focus:border-aqua-500 transition-colors"
                        >
                          <option value="">Select your gender</option>
                          <option value="Female">Female</option>
                          <option value="Male">Male</option>
                          <option value="Nonbinary">Nonbinary</option>
                          <option value="Other">Other</option>
                          <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                      </div>
                    </div>
                    
                    <div className="space-y-4">
                      <h3 className="text-lg font-semibold text-gray-700">Experience</h3>
                      <div className="flex flex-col sm:flex-row gap-4">
                        <label className="flex items-center space-x-3 p-4 bg-white rounded-lg border border-gray-200 hover:border-aqua-300 transition-colors cursor-pointer">
                          <input
                            type="checkbox"
                            name="leadership"
                            checked={user.leadership}
                            onChange={handleChange}
                            className="w-5 h-5 text-aqua-600 border-gray-300 rounded focus:ring-aqua-500"
                          />
                          <span className="text-gray-700 font-medium">I have leadership experience</span>
                        </label>
                        <label className="flex items-center space-x-3 p-4 bg-white rounded-lg border border-gray-200 hover:border-aqua-300 transition-colors cursor-pointer">
                          <input
                            type="checkbox"
                            name="community"
                            checked={user.community}
                            onChange={handleChange}
                            className="w-5 h-5 text-aqua-600 border-gray-300 rounded focus:ring-aqua-500"
                          />
                          <span className="text-gray-700 font-medium">I have community service experience</span>
                        </label>
                      </div>
                    </div>
                    
                    <div className="text-center pt-4">
                      <button
                        type="submit"
                        disabled={loading}
                        className={`font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200 text-lg ${
                          loading 
                            ? 'bg-gray-400 text-gray-600 cursor-not-allowed' 
                            : 'bg-gradient-to-r from-aqua-500 to-aqua-600 hover:from-aqua-600 hover:to-aqua-700 text-white'
                        }`}
                      >
                        {loading ? '⏳ Saving...' : '🎯 Find My Scholarships'}
                      </button>
                    </div>
                  </form>
                </div>
              ) : (
                <div className="space-y-6">
                  <div className="text-center">
                    <h2 className="text-3xl font-bold text-aqua-600 mb-2">Hi {user.name}! 🎉</h2>
                    <p className="text-lg text-gray-600">Here are your personalized scholarship quests:</p>
                  </div>
                  
                  {relevantScholarships.length === 0 ? (
                    <div className="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
                      <div className="text-red-600 text-xl mb-2">😔</div>
                      <h3 className="text-xl font-semibold text-red-700 mb-2">No Scholarships Found</h3>
                      <p className="text-red-600">No scholarships matched your profile. Try adjusting your information!</p>
                    </div>
                  ) : (
                    <div className="grid gap-6">
                      {relevantScholarships.map((sch) => (
                        <div key={sch.id} className="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 p-6 border border-gray-100">
                          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <div className="flex-1">
                              <div className="flex items-center gap-3 mb-3">
                                <h3 className="text-xl font-bold text-aqua-700">{sch.name}</h3>
                                <span className="bg-aqua-100 text-aqua-700 px-3 py-1 rounded-full text-sm font-semibold">
                                  +{sch.reward} XP
                                </span>
                              </div>
                              <p className="text-gray-600 mb-4">{sch.description}</p>
                            </div>
                            <div className="flex-shrink-0">
                              <button
                                disabled={applied.includes(sch.id)}
                                onClick={() => handleApply(sch)}
                                className={`px-6 py-3 rounded-lg font-semibold transition-all duration-200 ${
                                  applied.includes(sch.id)
                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                    : 'bg-gradient-to-r from-aqua-500 to-aqua-600 hover:from-aqua-600 hover:to-aqua-700 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1'
                                }`}
                              >
                                {applied.includes(sch.id) ? '✅ Applied!' : '🚀 Apply Now'}
                              </button>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                  
                  <div className="text-center pt-6">
                    <button
                      onClick={() => { setSubmitted(false); setApplied([]); setXp(0); }}
                      className="bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                      🔄 Start Over
                    </button>
                  </div>
                </div>
              )}
              
              <div className="text-center mt-8 pt-6 border-t border-gray-200">
                <p className="text-gray-500 text-sm">
                  <span className="text-aqua-500">✨</span> ScholarQuest: Level up your future, one scholarship at a time!
                </p>
              </div>
            </div>
          </div>
        </div>
          );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ScholarQuest />);
    </script>
</body>
</html>